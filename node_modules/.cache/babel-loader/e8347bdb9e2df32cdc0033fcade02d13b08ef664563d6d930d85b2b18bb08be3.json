{"ast":null,"code":"/*\n * Copyright 2008 ZXing authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nimport BarcodeFormat from '../BarcodeFormat';\nimport DecodeHintType from '../DecodeHintType';\nimport Result from '../Result';\nimport ResultMetadataType from '../ResultMetadataType';\nimport ResultPoint from '../ResultPoint';\nimport UPCEANExtensionSupport from './UPCEANExtensionSupport';\nimport AbstractUPCEANReader from './AbstractUPCEANReader';\nimport NotFoundException from '../NotFoundException';\nimport FormatException from '../FormatException';\nimport ChecksumException from '../ChecksumException';\n/**\n * <p>Encapsulates functionality and implementation that is common to UPC and EAN families\n * of one-dimensional barcodes.</p>\n *\n * @author dswitkin@google.com (Daniel Switkin)\n * @author Sean Owen\n * @author alasdair@google.com (Alasdair Mackintosh)\n */\nvar UPCEANReader = /** @class */function (_super) {\n  __extends(UPCEANReader, _super);\n  function UPCEANReader() {\n    var _this = _super.call(this) || this;\n    _this.decodeRowStringBuffer = '';\n    UPCEANReader.L_AND_G_PATTERNS = UPCEANReader.L_PATTERNS.map(function (arr) {\n      return Int32Array.from(arr);\n    });\n    for (var i = 10; i < 20; i++) {\n      var widths = UPCEANReader.L_PATTERNS[i - 10];\n      var reversedWidths = new Int32Array(widths.length);\n      for (var j = 0; j < widths.length; j++) {\n        reversedWidths[j] = widths[widths.length - j - 1];\n      }\n      UPCEANReader.L_AND_G_PATTERNS[i] = reversedWidths;\n    }\n    return _this;\n  }\n  UPCEANReader.prototype.decodeRow = function (rowNumber, row, hints) {\n    var startGuardRange = UPCEANReader.findStartGuardPattern(row);\n    var resultPointCallback = hints == null ? null : hints.get(DecodeHintType.NEED_RESULT_POINT_CALLBACK);\n    if (resultPointCallback != null) {\n      var resultPoint_1 = new ResultPoint((startGuardRange[0] + startGuardRange[1]) / 2.0, rowNumber);\n      resultPointCallback.foundPossibleResultPoint(resultPoint_1);\n    }\n    var budello = this.decodeMiddle(row, startGuardRange, this.decodeRowStringBuffer);\n    var endStart = budello.rowOffset;\n    var result = budello.resultString;\n    if (resultPointCallback != null) {\n      var resultPoint_2 = new ResultPoint(endStart, rowNumber);\n      resultPointCallback.foundPossibleResultPoint(resultPoint_2);\n    }\n    var endRange = UPCEANReader.decodeEnd(row, endStart);\n    if (resultPointCallback != null) {\n      var resultPoint_3 = new ResultPoint((endRange[0] + endRange[1]) / 2.0, rowNumber);\n      resultPointCallback.foundPossibleResultPoint(resultPoint_3);\n    }\n    // Make sure there is a quiet zone at least as big as the end pattern after the barcode. The\n    // spec might want more whitespace, but in practice this is the maximum we can count on.\n    var end = endRange[1];\n    var quietEnd = end + (end - endRange[0]);\n    if (quietEnd >= row.getSize() || !row.isRange(end, quietEnd, false)) {\n      throw new NotFoundException();\n    }\n    var resultString = result.toString();\n    // UPC/EAN should never be less than 8 chars anyway\n    if (resultString.length < 8) {\n      throw new FormatException();\n    }\n    if (!UPCEANReader.checkChecksum(resultString)) {\n      throw new ChecksumException();\n    }\n    var left = (startGuardRange[1] + startGuardRange[0]) / 2.0;\n    var right = (endRange[1] + endRange[0]) / 2.0;\n    var format = this.getBarcodeFormat();\n    var resultPoint = [new ResultPoint(left, rowNumber), new ResultPoint(right, rowNumber)];\n    var decodeResult = new Result(resultString, null, 0, resultPoint, format, new Date().getTime());\n    var extensionLength = 0;\n    try {\n      var extensionResult = UPCEANExtensionSupport.decodeRow(rowNumber, row, endRange[1]);\n      decodeResult.putMetadata(ResultMetadataType.UPC_EAN_EXTENSION, extensionResult.getText());\n      decodeResult.putAllMetadata(extensionResult.getResultMetadata());\n      decodeResult.addResultPoints(extensionResult.getResultPoints());\n      extensionLength = extensionResult.getText().length;\n    } catch (err) {}\n    var allowedExtensions = hints == null ? null : hints.get(DecodeHintType.ALLOWED_EAN_EXTENSIONS);\n    if (allowedExtensions != null) {\n      var valid = false;\n      for (var length_1 in allowedExtensions) {\n        if (extensionLength.toString() === length_1) {\n          // check me\n          valid = true;\n          break;\n        }\n      }\n      if (!valid) {\n        throw new NotFoundException();\n      }\n    }\n    if (format === BarcodeFormat.EAN_13 || format === BarcodeFormat.UPC_A) {\n      // let countryID = eanManSupport.lookupContryIdentifier(resultString); todo\n      // if (countryID != null) {\n      //     decodeResult.putMetadata(ResultMetadataType.POSSIBLE_COUNTRY, countryID);\n      // }\n    }\n    return decodeResult;\n  };\n  UPCEANReader.checkChecksum = function (s) {\n    return UPCEANReader.checkStandardUPCEANChecksum(s);\n  };\n  UPCEANReader.checkStandardUPCEANChecksum = function (s) {\n    var length = s.length;\n    if (length === 0) return false;\n    var check = parseInt(s.charAt(length - 1), 10);\n    return UPCEANReader.getStandardUPCEANChecksum(s.substring(0, length - 1)) === check;\n  };\n  UPCEANReader.getStandardUPCEANChecksum = function (s) {\n    var length = s.length;\n    var sum = 0;\n    for (var i = length - 1; i >= 0; i -= 2) {\n      var digit = s.charAt(i).charCodeAt(0) - '0'.charCodeAt(0);\n      if (digit < 0 || digit > 9) {\n        throw new FormatException();\n      }\n      sum += digit;\n    }\n    sum *= 3;\n    for (var i = length - 2; i >= 0; i -= 2) {\n      var digit = s.charAt(i).charCodeAt(0) - '0'.charCodeAt(0);\n      if (digit < 0 || digit > 9) {\n        throw new FormatException();\n      }\n      sum += digit;\n    }\n    return (1000 - sum) % 10;\n  };\n  UPCEANReader.decodeEnd = function (row, endStart) {\n    return UPCEANReader.findGuardPattern(row, endStart, false, UPCEANReader.START_END_PATTERN, new Int32Array(UPCEANReader.START_END_PATTERN.length).fill(0));\n  };\n  return UPCEANReader;\n}(AbstractUPCEANReader);\nexport default UPCEANReader;","map":{"version":3,"names":["BarcodeFormat","DecodeHintType","Result","ResultMetadataType","ResultPoint","UPCEANExtensionSupport","AbstractUPCEANReader","NotFoundException","FormatException","ChecksumException","UPCEANReader","_super","__extends","_this","call","decodeRowStringBuffer","L_AND_G_PATTERNS","L_PATTERNS","map","arr","Int32Array","from","i","widths","reversedWidths","length","j","prototype","decodeRow","rowNumber","row","hints","startGuardRange","findStartGuardPattern","resultPointCallback","get","NEED_RESULT_POINT_CALLBACK","resultPoint_1","foundPossibleResultPoint","budello","decodeMiddle","endStart","rowOffset","result","resultString","resultPoint_2","endRange","decodeEnd","resultPoint_3","end","quietEnd","getSize","isRange","toString","checkChecksum","left","right","format","getBarcodeFormat","resultPoint","decodeResult","Date","getTime","extensionLength","extensionResult","putMetadata","UPC_EAN_EXTENSION","getText","putAllMetadata","getResultMetadata","addResultPoints","getResultPoints","err","allowedExtensions","ALLOWED_EAN_EXTENSIONS","valid","length_1","EAN_13","UPC_A","s","checkStandardUPCEANChecksum","check","parseInt","charAt","getStandardUPCEANChecksum","substring","sum","digit","charCodeAt","findGuardPattern","START_END_PATTERN","fill"],"sources":["../../../../src/core/oned/UPCEANReader.ts"],"sourcesContent":[null],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}